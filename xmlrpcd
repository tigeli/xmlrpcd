#!/usr/bin/perl

use warnings;
use strict;

use HTTP::Daemon::SSL;
use IO::Socket::SSL;
use HTTP::Status;

#-----------------------------------------------------------------------------

my $cert = 'x509/actual.cert.pem';
my $key  = 'x509/actual.key.pem';

my $daemon = new HTTP::Daemon::SSL(
  SSL_cert_file => $cert,
  SSL_key_file  => $key,
  LocalPort => 1638,
  LocalAddr => 'localhost',
  Listen => 1,
);

while (1) {
  my $c = $daemon->accept or next;
  while (my $req = $c->get_request) {
    if ($req->method ne 'POST') {
      $c->send_error(RC_FORBIDDEN);
    }

    use YAML;
    print Dump $req;
  }
}

#-----------------------------------------------------------------------------
# vim:ft=perl
